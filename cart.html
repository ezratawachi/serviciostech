<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Carrito de servicios | Canal Datos</title>

    <meta
      name="description"
      content="Revisa los servicios seleccionados, ajusta cantidades y env√≠a tu pedido para coordinar la implementaci√≥n con Canal Datos."
    />
    <meta name="author" content="Canal Datos" />
    <meta name="theme-color" content="#030712" />

    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üõí</text></svg>"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Space+Grotesk:wght@500;600;700&display=swap"
      rel="stylesheet"
    />

    <script>
      window.tailwind = window.tailwind || {};
      window.tailwind.config = {
        theme: {
          extend: {
            screens: { xs: "475px" },
            colors: {
              midnight: {
                50: "#f8fafc",
                100: "#e2e8f0",
                200: "#cbd5f5",
                300: "#94a3f8",
                400: "#818cf8",
                500: "#6366f1",
                600: "#4f46e5",
                700: "#312e81",
                800: "#1e1b4b",
                900: "#111032",
                950: "#05051a",
              },
              aura: {
                200: "#5eead4",
                300: "#2dd4bf",
                400: "#14b8a6",
                500: "#0d9488",
              },
            },
            boxShadow: {
              glass: "0 18px 40px rgba(15, 23, 42, 0.45)",
              glow: "0 30px 80px rgba(99, 102, 241, 0.45)",
            },
            fontFamily: {
              sans: [
                "Inter",
                "Space Grotesk",
                "ui-sans-serif",
                "system-ui",
                "-apple-system",
                "Segoe UI",
                "Roboto",
                "Helvetica",
                "Arial",
                "Apple Color Emoji",
                "Segoe UI Emoji",
              ],
              display: [
                "Space Grotesk",
                "Inter",
                "ui-sans-serif",
                "system-ui",
                "-apple-system",
              ],
            },
            borderRadius: {
              pill: "999px",
              xl: "1rem",
              "2xl": "1.5rem",
            },
          },
        },
      };
    </script>
    <script defer src="https://cdn.tailwindcss.com"></script>

    <style>
      :root {
        color-scheme: dark;
        scroll-behavior: smooth;
      }
      body {
        background: radial-gradient(circle at top right, rgba(99, 102, 241, 0.16), transparent 46%),
          radial-gradient(circle at 18% 22%, rgba(45, 212, 191, 0.12), transparent 40%),
          #020617;
      }
      .skip-link {
        position: absolute;
        left: -999px;
        top: 1rem;
        padding: 0.6rem 1.2rem;
        background: linear-gradient(120deg, #4f46e5, #14b8a6);
        color: #f8fafc;
        border-radius: 999px;
        box-shadow: 0 18px 40px rgba(79, 70, 229, 0.45);
        transition: left 0.2s ease;
        z-index: 200;
        font-weight: 600;
        letter-spacing: 0.04em;
      }
      .skip-link:focus {
        left: 1rem;
      }
      .toast-layer {
        position: fixed;
        left: 50%;
        bottom: 1.5rem;
        transform: translate(-50%, 12px);
        z-index: 120;
        border-radius: 999px;
        background: linear-gradient(140deg, rgba(79, 70, 229, 0.88), rgba(45, 212, 191, 0.88));
        color: #020817;
        padding: 0.65rem 1.4rem;
        font-size: 0.85rem;
        font-weight: 600;
        box-shadow: 0 18px 44px rgba(99, 102, 241, 0.45);
        transition: opacity 0.25s ease, transform 0.25s ease;
        pointer-events: none;
      }
      body.is-loading {
        opacity: 0;
      }
      body.is-ready {
        opacity: 1;
        transition: opacity 0.35s ease;
      }
    </style>
  </head>
  <body class="bg-[#020617] text-slate-100 font-sans antialiased is-loading">
    <a href="#contenido-principal" class="skip-link">Saltar al contenido</a>

    <header class="sticky top-0 z-40 border-b border-white/10 bg-[#03091d]/85 backdrop-blur-xl">
      <nav class="mx-auto w-full max-w-7xl px-4 sm:px-6 lg:px-8" aria-label="Principal">
        <div class="flex h-16 items-center justify-between gap-4">
          <a href="index.html" class="flex items-center gap-2 text-sm font-semibold text-slate-200">
            <span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-white/10 text-base font-display font-semibold text-white shadow-glow">
              CD
            </span>
            <span class="text-base font-display tracking-tight">Canal Datos</span>
          </a>
          <div class="hidden items-center gap-2 text-sm font-medium md:flex">
            <a href="index.html#galeria" class="rounded-lg px-3 py-2 text-slate-300 transition hover:bg-white/10 hover:text-white">Servicios</a>
            <a href="index.html#detalles" class="rounded-lg px-3 py-2 text-slate-300 transition hover:bg-white/10 hover:text-white">Casos</a>
            <a href="index.html#contacto" class="rounded-lg px-3 py-2 text-slate-300 transition hover:bg-white/10 hover:text-white">Contacto</a>
            <a
              href="cart.html"
              aria-current="page"
              class="relative inline-flex items-center gap-2 rounded-pill border border-white/10 bg-white/10 px-3 py-2 text-white shadow-[0_1px_0_rgba(255,255,255,0.1)]"
            >
              Carrito
              <span
                data-cart-count
                class="inline-flex h-5 min-w-[1.25rem] items-center justify-center rounded-full bg-midnight-500 px-1 text-[10px] font-extrabold leading-none text-white"
                aria-live="polite"
              ></span>
            </a>
          </div>
          <button
            type="button"
            id="mobile-menu-button"
            class="inline-flex h-11 w-11 items-center justify-center rounded-xl border border-white/10 bg-white/5 text-white/80 transition hover:bg-white/10 md:hidden"
            aria-controls="mobile-menu"
            aria-expanded="false"
          >
            <span class="sr-only">Abrir men√∫</span>
            <svg
              data-menu-icon="open"
              class="h-6 w-6"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              aria-hidden="true"
            >
              <path d="M4 6h16M4 12h16M4 18h16" />
            </svg>
            <svg
              data-menu-icon="close"
              class="hidden h-6 w-6"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              aria-hidden="true"
            >
              <path d="M6 6l12 12M6 18L18 6" />
            </svg>
          </button>
        </div>
      </nav>
      <div id="mobile-menu" class="hidden border-t border-white/10 bg-[#020a1a]/95 md:hidden">
        <div class="mx-auto flex max-w-7xl flex-col gap-2 px-4 py-4 text-sm font-semibold text-slate-200">
          <a data-mobile-link href="index.html#galeria" class="rounded-lg px-3 py-2 hover:bg-white/10">Servicios</a>
          <a data-mobile-link href="index.html#detalles" class="rounded-lg px-3 py-2 hover:bg-white/10">Casos</a>
          <a data-mobile-link href="index.html#contacto" class="rounded-lg px-3 py-2 hover:bg-white/10">Contacto</a>
          <a data-mobile-link href="cart.html" class="flex items-center justify-between rounded-lg px-3 py-2 hover:bg-white/10">
            Carrito
            <span
              data-cart-count
              class="inline-flex h-5 w-5 items-center justify-center rounded-full bg-midnight-500 text-[10px] font-extrabold leading-none text-white"
            ></span>
          </a>
        </div>
      </div>
    </header>

    <main id="contenido-principal" class="py-16 sm:py-20" tabindex="-1">
      <section class="relative">
        <div class="absolute inset-x-0 top-0 h-px bg-gradient-to-r from-transparent via-white/10 to-transparent"></div>
        <div class="mx-auto w-full max-w-6xl px-4 sm:px-6 lg:px-8">
          <header class="text-center" data-animate="fade-up">
            <p class="text-xs font-semibold uppercase tracking-[0.32em] text-white/60">Resumen</p>
            <h1 class="mt-3 text-3xl font-display font-semibold text-white sm:text-4xl">Tu carrito de servicios</h1>
            <p class="mx-auto mt-3 max-w-2xl text-sm sm:text-base text-slate-300">
              Ajusta cantidades y env√≠a tus datos. Te responder√© en menos de 24 horas h√°biles con la agenda y pr√≥ximos pasos.
            </p>
          </header>

          <div class="mt-10 grid gap-6 lg:grid-cols-[1.25fr_0.85fr]">
            <section class="space-y-4" data-animate="fade-up" data-animate-delay="0.05s">
              <div class="overflow-hidden rounded-[1.8rem] border border-white/10 bg-white/5 shadow-glass backdrop-blur-xl">
                <div class="flex items-center justify-between border-b border-white/10 px-6 py-5">
                  <h2 class="text-base font-semibold text-white">Servicios seleccionados</h2>
                  <button
                    type="button"
                    id="clear-cart"
                    class="text-xs font-semibold uppercase tracking-[0.28em] text-white/60 transition hover:text-white"
                  >
                    Vaciar carrito
                  </button>
                </div>
                <div id="cart-items" class="divide-y divide-white/5">
                  <!-- Items renderizados por JS -->
                </div>
                <div class="flex items-center justify-between px-6 py-5">
                  <span class="text-sm font-semibold text-slate-300">Total estimado</span>
                  <span id="cart-total" class="text-xl font-semibold text-white">USD $0</span>
                </div>
              </div>

              <a
                href="index.html#galeria"
                class="inline-flex w-full items-center justify-center gap-2 rounded-pill border border-white/10 bg-white/10 px-5 py-3 text-sm font-semibold text-white transition hover:bg-white/20"
              >
                ‚Üê Seguir explorando servicios
              </a>
            </section>

            <section
              class="rounded-[1.8rem] border border-white/10 bg-white/5 p-8 shadow-glass backdrop-blur-xl"
              data-animate="fade-up"
              data-animate-delay="0.1s"
            >
              <h2 class="text-base font-semibold text-white">Env√≠a tu pedido</h2>
              <p class="mt-1 text-sm text-slate-300">Completa tus datos. Recibir√°s confirmaci√≥n y propuesta de agenda.</p>
              <form id="checkout-form" class="mt-6 space-y-4 text-left">
                <div>
                  <label for="name" class="text-sm font-medium text-white/80">Nombre completo</label>
                  <input
                    type="text"
                    id="name"
                    name="name"
                    required
                    autocomplete="name"
                    class="mt-1 w-full rounded-xl border border-white/15 bg-white/5 px-3 py-2 text-sm text-white placeholder:text-slate-400 focus-visible:border-midnight-400 focus-visible:outline-none"
                  />
                </div>
                <div>
                  <label for="email" class="text-sm font-medium text-white/80">Correo electr√≥nico</label>
                  <input
                    type="email"
                    id="email"
                    name="email"
                    required
                    autocomplete="email"
                    class="mt-1 w-full rounded-xl border border-white/15 bg-white/5 px-3 py-2 text-sm text-white placeholder:text-slate-400 focus-visible:border-midnight-400 focus-visible:outline-none"
                  />
                </div>
                <div>
                  <label
                    class="flex items-start gap-3 rounded-xl border border-white/15 bg-white/5 px-3 py-3 text-sm font-medium text-white/80"
                    for="whatsapp-opt-in"
                  >
                    <input
                      id="whatsapp-opt-in"
                      name="whatsappOptIn"
                      type="checkbox"
                      class="mt-1 h-4 w-4 rounded border-white/30 bg-white/10 text-midnight-400 transition focus:ring-midnight-300"
                    />
                    <span>
                      ¬øQuieres coordinaci√≥n por WhatsApp?
                      <span class="mt-1 block text-xs font-normal text-slate-400">
                        Si activas esta opci√≥n, ind√≠canos tu n√∫mero y recibir√°s seguimiento directo.
                      </span>
                    </span>
                  </label>
                </div>
                <div id="whatsapp-field" class="hidden">
                  <label for="whatsapp-number" class="text-sm font-medium text-white/80">N√∫mero de WhatsApp</label>
                  <input
                    type="tel"
                    id="whatsapp-number"
                    name="whatsappNumber"
                    autocomplete="tel"
                    inputmode="tel"
                    placeholder="Ej: +507 6000-0000"
                    class="mt-1 w-full rounded-xl border border-white/15 bg-white/5 px-3 py-2 text-sm text-white placeholder:text-slate-400 focus-visible:border-midnight-400 focus-visible:outline-none"
                  />
                </div>
                <div>
                  <label for="company" class="text-sm font-medium text-white/80">Empresa (opcional)</label>
                  <input
                    type="text"
                    id="company"
                    name="company"
                    autocomplete="organization"
                    class="mt-1 w-full rounded-xl border border-white/15 bg-white/5 px-3 py-2 text-sm text-white placeholder:text-slate-400 focus-visible:border-midnight-400 focus-visible:outline-none"
                  />
                </div>
                <button
                  type="submit"
                  class="inline-flex w-full items-center justify-center gap-2 rounded-pill bg-gradient-to-r from-midnight-500 to-aura-400 px-5 py-2.5 text-sm font-semibold text-white shadow-glow transition hover:from-midnight-400 hover:to-aura-300 disabled:cursor-not-allowed disabled:opacity-50"
                >
                  Enviar pedido
                </button>
              </form>
            </section>
          </div>
        </div>
      </section>
    </main>

    <footer class="border-t border-white/10 bg-[#03091d]/80">
      <div class="mx-auto w-full max-w-7xl px-4 py-6 text-center text-xs sm:text-sm text-slate-400">
        ¬© 2025 Canal Datos ¬∑ Automatizaci√≥n y anal√≠tica para empresas en Panam√°.
      </div>
    </footer>

    <div id="toast" class="toast-layer" style="opacity: 0"></div>

    <script>
      const storageKey = "ezraServicesCart";
      const EMAIL_ENDPOINT =
        "https://script.google.com/macros/s/AKfycbxsveSHW1PjbIKBQv4apyYQhaWWe-JnL6I1f2Kf4yOHLWFlTgzLl67Vgp8qZAOhLQHb/exec";

      const itemsContainer = document.getElementById("cart-items");
      const totalEl = document.getElementById("cart-total");
      const toastLayer = document.getElementById("toast");
      const clearBtn = document.getElementById("clear-cart");
      const mobileMenuButton = document.getElementById("mobile-menu-button");
      const mobileMenu = document.getElementById("mobile-menu");
      const whatsappCheckbox = document.getElementById("whatsapp-opt-in");
      const whatsappFieldWrapper = document.getElementById("whatsapp-field");
      const whatsappInput = document.getElementById("whatsapp-number");

      const syncWhatsappField = () => {
        if (!whatsappCheckbox || !whatsappFieldWrapper || !whatsappInput) return;
        const wantsWhatsapp = whatsappCheckbox.checked;
        whatsappFieldWrapper.classList.toggle("hidden", !wantsWhatsapp);
        whatsappInput.required = wantsWhatsapp;
        if (!wantsWhatsapp) {
          whatsappInput.value = "";
        }
      };

      if (whatsappCheckbox) {
        whatsappCheckbox.addEventListener("change", syncWhatsappField);
        syncWhatsappField();
      }

      if (mobileMenuButton && mobileMenu) {
        const mobileMenuIcons = {
          open: mobileMenuButton.querySelector('[data-menu-icon="open"]'),
          close: mobileMenuButton.querySelector('[data-menu-icon="close"]'),
        };

        const setMenuState = (open) => {
          mobileMenuButton.setAttribute("aria-expanded", String(open));
          if (open) {
            mobileMenu.classList.remove("hidden");
            if (mobileMenuIcons.open) {
              mobileMenuIcons.open.classList.add("hidden");
            }
            if (mobileMenuIcons.close) {
              mobileMenuIcons.close.classList.remove("hidden");
            }
          } else {
            mobileMenu.classList.add("hidden");
            if (mobileMenuIcons.open) {
              mobileMenuIcons.open.classList.remove("hidden");
            }
            if (mobileMenuIcons.close) {
              mobileMenuIcons.close.classList.add("hidden");
            }
          }
        };

        mobileMenuButton.addEventListener("click", () => {
          const isOpen = mobileMenuButton.getAttribute("aria-expanded") === "true";
          setMenuState(!isOpen);
        });

        document.querySelectorAll("[data-mobile-link]").forEach((link) => {
          link.addEventListener("click", () => setMenuState(false));
        });

        const desktopBreakpoint = window.matchMedia("(min-width: 768px)");
        const handleBreakpointChange = (event) => {
          if (event.matches) {
            setMenuState(false);
          }
        };

        if (typeof desktopBreakpoint.addEventListener === "function") {
          desktopBreakpoint.addEventListener("change", handleBreakpointChange);
        } else if (typeof desktopBreakpoint.addListener === "function") {
          desktopBreakpoint.addListener(handleBreakpointChange);
        }

        setMenuState(false);
      }

      const formatCurrency = (value) =>
        new Intl.NumberFormat("es-PA", {
          style: "currency",
          currency: "USD",
          minimumFractionDigits: 0,
        }).format(value);

      function getCart() {
        try {
          const raw = localStorage.getItem(storageKey);
          return raw ? JSON.parse(raw) : [];
        } catch (error) {
          console.error("No se pudo leer el carrito", error);
          return [];
        }
      }

      function setCart(items) {
        try {
          localStorage.setItem(storageKey, JSON.stringify(items));
        } catch (error) {
          console.error("No se pudo guardar el carrito", error);
        }
      }

      function showToast(message) {
        toastLayer.textContent = message;
        toastLayer.style.opacity = "1";
        toastLayer.style.transform = "translate(-50%, 0)";
        setTimeout(() => {
          toastLayer.style.opacity = "0";
          toastLayer.style.transform = "translate(-50%, 12px)";
        }, 2000);
      }

      function updateBadge() {
        const count = getCart().reduce((sum, item) => sum + (item.qty || 1), 0);
        document.querySelectorAll("[data-cart-count]").forEach((badge) => {
          if (badge) {
            badge.textContent = count;
            badge.classList.toggle("hidden", count === 0);
          }
        });
      }

      function renderCart() {
        const cart = getCart();
        itemsContainer.innerHTML = "";

        if (!cart.length) {
          itemsContainer.innerHTML = `
            <div class="px-6 py-10 text-center text-sm text-slate-400">
              Tu carrito est√° vac√≠o. A√±ade servicios desde la p√°gina principal.
            </div>
          `;
          totalEl.textContent = formatCurrency(0);
          updateBadge();
          return;
        }

        cart.forEach((item, index) => {
          const row = document.createElement("div");
          row.className = "flex flex-col gap-4 px-6 py-4 text-sm text-slate-200 sm:flex-row sm:items-center sm:justify-between";
          row.innerHTML = `
            <div>
              <p class="font-semibold text-white">${item.name}</p>
              <p class="text-xs text-slate-400">${formatCurrency(item.price)} por servicio</p>
            </div>
            <div class="flex items-center gap-3">
              <div class="flex items-center gap-2 rounded-pill border border-white/12 bg-white/8 px-2 py-1">
                <button
                  type="button"
                  class="inline-flex h-7 w-7 items-center justify-center rounded-lg border border-white/10 text-white/80 transition hover:bg-white/15"
                  data-action="decrement"
                  data-index="${index}"
                  aria-label="Reducir cantidad"
                >
                  ‚àí
                </button>
                <span class="min-w-[2rem] text-center font-semibold text-white">${item.qty || 1}</span>
                <button
                  type="button"
                  class="inline-flex h-7 w-7 items-center justify-center rounded-lg border border-white/10 text-white/80 transition hover:bg-white/15"
                  data-action="increment"
                  data-index="${index}"
                  aria-label="Incrementar cantidad"
                >
                  +
                </button>
              </div>
              <button
                type="button"
                class="inline-flex items-center gap-2 rounded-pill border border-white/10 px-3 py-1.5 text-xs font-semibold text-white/70 transition hover:border-rose-300/60 hover:text-rose-200"
                data-action="remove"
                data-index="${index}"
              >
                Eliminar
              </button>
            </div>
          `;
          itemsContainer.appendChild(row);
        });

        const total = cart.reduce((sum, item) => sum + item.price * (item.qty || 1), 0);
        totalEl.textContent = formatCurrency(total);
        updateBadge();
      }

      itemsContainer.addEventListener("click", (event) => {
        const target = event.target.closest("button[data-action]");
        if (!target) return;

        const action = target.getAttribute("data-action");
        const index = Number(target.getAttribute("data-index"));
        const cart = getCart();
        const item = cart[index];
        if (!item) return;

        if (action === "increment") {
          item.qty = (item.qty || 1) + 1;
          setCart(cart);
          renderCart();
        }

        if (action === "decrement") {
          const nextQty = (item.qty || 1) - 1;
          if (nextQty <= 0) {
            cart.splice(index, 1);
          } else {
            item.qty = nextQty;
          }
          setCart(cart);
          renderCart();
        }

        if (action === "remove") {
          cart.splice(index, 1);
          setCart(cart);
          renderCart();
        }
      });

      clearBtn.addEventListener("click", () => {
        setCart([]);
        renderCart();
        showToast("Carrito vaciado");
      });

      document
        .getElementById("checkout-form")
        .addEventListener("submit", async (event) => {
          event.preventDefault();
          const form = event.target;
          const submitBtn = form.querySelector('button[type="submit"]');
          const cart = getCart();

          if (!cart.length) {
            showToast("Tu carrito est√° vac√≠o");
            return;
          }

          const payload = {
            name: form.name.value.trim(),
            email: form.email.value.trim(),
            company: form.company.value.trim(),
            whatsappOptIn: whatsappCheckbox ? whatsappCheckbox.checked : false,
            whatsappNumber: whatsappInput ? whatsappInput.value.trim() : "",
            cart,
            total: cart.reduce((sum, item) => sum + item.price * (item.qty || 1), 0),
            createdAt: new Date().toISOString(),
            source: "Servicios - cart.html",
          };

          submitBtn.disabled = true;
          const originalText = submitBtn.textContent;
          submitBtn.textContent = "Enviando...";

          try {
            const res = await fetch(EMAIL_ENDPOINT, {
              method: "POST",
              headers: {
                "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8",
              },
              body: "payload=" + encodeURIComponent(JSON.stringify(payload)),
            });

            if (!res.ok) throw new Error("Solicitud fallida");

            showToast("Pedido enviado. Te contactaremos muy pronto.");
            setCart([]);
            renderCart();
            form.reset();
            syncWhatsappField();
            setTimeout(() => {
              window.location.href = "index.html";
            }, 2200);
          } catch (error) {
            console.error("Error enviando pedido", error);
            showToast("No se pudo enviar. Intenta nuevamente.");
          } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = originalText;
          }
        });

      renderCart();
      updateBadge();

      window.addEventListener("storage", (event) => {
        if (event.key === storageKey) {
          renderCart();
        }
      });

      window.addEventListener("load", () => {
        document.body.classList.remove("is-loading");
        document.body.classList.add("is-ready");
      });
    </script>
  </body>
</html>
